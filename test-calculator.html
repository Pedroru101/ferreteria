<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Calculadora de Materiales</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/calculator.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 20px;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .test-header {
            background: var(--gradient-primary);
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
        }

        .test-header h1 {
            margin: 0;
            font-size: 2em;
        }

        .test-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-section h2 {
            color: var(--primary);
            margin-top: 0;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
        }

        .test-case {
            background: var(--bg-secondary);
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid var(--primary);
        }

        .test-case h3 {
            margin: 0 0 10px 0;
            color: var(--primary);
        }

        .test-input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .test-input {
            display: flex;
            flex-direction: column;
        }

        .test-input label {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-primary);
        }

        .test-input input,
        .test-input select {
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1em;
        }

        .test-input input:focus,
        .test-input select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(45, 122, 62, 0.1);
        }

        .test-button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px 5px 10px 0;
        }

        .test-button:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(45, 122, 62, 0.3);
        }

        .test-button.secondary {
            background: var(--accent);
        }

        .test-button.secondary:hover {
            background: var(--accent-light);
        }

        .test-results {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            border: 1px solid var(--border);
        }

        .test-results h4 {
            margin-top: 0;
            color: var(--primary);
        }

        .result-item {
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .result-value {
            color: var(--primary);
            font-weight: 700;
            font-size: 1.1em;
        }

        .status-pass {
            color: #4caf50;
            font-weight: 600;
        }

        .status-fail {
            color: #d32f2f;
            font-weight: 600;
        }

        .device-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .device-btn {
            padding: 10px 20px;
            border: 2px solid var(--border);
            background: var(--bg-card);
            color: var(--text-primary);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .device-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .device-info {
            background: var(--accent-light);
            color: var(--text-primary);
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        @media (max-width: 767px) {
            .test-input-group {
                grid-template-columns: 1fr;
            }

            .test-header {
                padding: 20px;
            }

            .test-header h1 {
                font-size: 1.5em;
            }
        }

        .error-message {
            background: #ffebee;
            color: #d32f2f;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #d32f2f;
        }

        .success-message {
            background: #e8f5e9;
            color: #2d7a3e;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #2d7a3e;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1><i class="fas fa-calculator"></i> Test - Calculadora de Materiales</h1>
            <p>Prueba interactiva de la calculadora en diferentes dispositivos</p>
        </div>

        <!-- Device Selector -->
        <div class="test-section">
            <h2>Selector de Dispositivo</h2>
            <div class="device-selector">
                <button class="device-btn active" onclick="setDevice('mobile')">
                    <i class="fas fa-mobile-alt"></i> Mobile (320px)
                </button>
                <button class="device-btn" onclick="setDevice('tablet')">
                    <i class="fas fa-tablet-alt"></i> Tablet (768px)
                </button>
                <button class="device-btn" onclick="setDevice('desktop')">
                    <i class="fas fa-desktop"></i> Desktop (1200px)
                </button>
            </div>
            <div class="device-info" id="deviceInfo">
                Ancho actual: <span id="currentWidth">320</span>px
            </div>
        </div>

        <!-- Test 1: Cálculo de Perímetro -->
        <div class="test-section">
            <h2><i class="fas fa-ruler"></i> Test 1: Cálculo de Perímetro</h2>
            <div class="test-case">
                <h3>Ingresa dimensiones del terreno</h3>
                <div class="test-input-group">
                    <div class="test-input">
                        <label for="length">Largo (metros)</label>
                        <input type="number" id="length" placeholder="Ej: 20" min="0" step="0.1">
                    </div>
                    <div class="test-input">
                        <label for="width">Ancho (metros)</label>
                        <input type="number" id="width" placeholder="Ej: 15" min="0" step="0.1">
                    </div>
                </div>
                <button class="test-button" onclick="testPerimeter()">Calcular Perímetro</button>
                <div id="perimeterResults"></div>
            </div>
        </div>

        <!-- Test 2: Cálculo de Postes -->
        <div class="test-section">
            <h2><i class="fas fa-cube"></i> Test 2: Cálculo de Postes</h2>
            <div class="test-case">
                <h3>Calcula cantidad de postes necesarios</h3>
                <div class="test-input-group">
                    <div class="test-input">
                        <label for="perimeterInput">Perímetro (metros)</label>
                        <input type="number" id="perimeterInput" placeholder="Ej: 70" min="0" step="0.1">
                    </div>
                    <div class="test-input">
                        <label for="spacing">Espaciado entre postes (metros)</label>
                        <input type="number" id="spacing" placeholder="Ej: 2.5" min="0.5" step="0.1" value="2.5">
                    </div>
                </div>
                <button class="test-button" onclick="testPosts()">Calcular Postes</button>
                <div id="postsResults"></div>
            </div>
        </div>

        <!-- Test 3: Cálculo de Alambre y Tejido -->
        <div class="test-section">
            <h2><i class="fas fa-link"></i> Test 3: Cálculo de Alambre y Tejido</h2>
            <div class="test-case">
                <h3>Alambre</h3>
                <div class="test-input-group">
                    <div class="test-input">
                        <label for="wirePerimeter">Perímetro (metros)</label>
                        <input type="number" id="wirePerimeter" placeholder="Ej: 100" min="0" step="0.1">
                    </div>
                    <div class="test-input">
                        <label for="strands">Número de hilos</label>
                        <input type="number" id="strands" placeholder="Ej: 5" min="1" step="1" value="5">
                    </div>
                </div>
                <button class="test-button" onclick="testWire()">Calcular Alambre</button>
                <div id="wireResults"></div>
            </div>

            <div class="test-case">
                <h3>Tejido Romboidal</h3>
                <div class="test-input-group">
                    <div class="test-input">
                        <label for="meshPerimeter">Perímetro (metros)</label>
                        <input type="number" id="meshPerimeter" placeholder="Ej: 100" min="0" step="0.1">
                    </div>
                    <div class="test-input">
                        <label for="meshHeight">Altura (metros)</label>
                        <select id="meshHeight">
                            <option value="1.0">1.00m</option>
                            <option value="1.2">1.20m</option>
                            <option value="1.5" selected>1.50m</option>
                            <option value="1.8">1.80m</option>
                            <option value="2.0">2.00m</option>
                        </select>
                    </div>
                </div>
                <button class="test-button" onclick="testMesh()">Calcular Tejido</button>
                <div id="meshResults"></div>
            </div>
        </div>

        <!-- Test 4: Lógica Olimpo -->
        <div class="test-section">
            <h2><i class="fas fa-shield-alt"></i> Test 4: Lógica Especial Postes Olimpo</h2>
            <div class="test-case">
                <h3>Postes Olimpo (Hormigón + 3 hilos de púa)</h3>
                <div class="test-input-group">
                    <div class="test-input">
                        <label for="olimpoPerimeter">Perímetro (metros)</label>
                        <input type="number" id="olimpoPerimeter" placeholder="Ej: 100" min="0" step="0.1">
                    </div>
                </div>
                <button class="test-button" onclick="testOlimpo()">Calcular Olimpo</button>
                <div id="olimpoResults"></div>
            </div>
        </div>

        <!-- Test 5: Validación de Inputs -->
        <div class="test-section">
            <h2><i class="fas fa-check-circle"></i> Test 5: Validación de Inputs</h2>
            <div class="test-case">
                <h3>Prueba validación de diferentes valores</h3>
                <div class="test-input-group">
                    <div class="test-input">
                        <label for="validationInput">Valor a validar</label>
                        <input type="text" id="validationInput" placeholder="Ej: 10, abc, -5, 0">
                    </div>
                </div>
                <button class="test-button" onclick="testValidation()">Validar</button>
                <div id="validationResults"></div>
            </div>
        </div>

        <!-- Test 6: Cálculo Completo -->
        <div class="test-section">
            <h2><i class="fas fa-cogs"></i> Test 6: Cálculo Completo Integrado</h2>
            <div class="test-case">
                <h3>Cálculo completo con todos los parámetros</h3>
                <div class="test-input-group">
                    <div class="test-input">
                        <label for="compLength">Largo (metros)</label>
                        <input type="number" id="compLength" placeholder="Ej: 20" min="0" step="0.1">
                    </div>
                    <div class="test-input">
                        <label for="compWidth">Ancho (metros)</label>
                        <input type="number" id="compWidth" placeholder="Ej: 15" min="0" step="0.1">
                    </div>
                    <div class="test-input">
                        <label for="compPostType">Tipo de Poste</label>
                        <select id="compPostType">
                            <option value="hormigon">Hormigón</option>
                            <option value="quebracho">Quebracho</option>
                            <option value="eucalipto">Eucalipto</option>
                            <option value="olimpo">Olimpo</option>
                        </select>
                    </div>
                    <div class="test-input">
                        <label for="compMaterialType">Tipo de Material</label>
                        <select id="compMaterialType">
                            <option value="wire">Alambre</option>
                            <option value="mesh">Tejido</option>
                        </select>
                    </div>
                </div>
                <button class="test-button" onclick="testComplete()">Calcular Completo</button>
                <div id="completeResults"></div>
            </div>
        </div>

        <!-- Test Summary -->
        <div class="test-section">
            <h2><i class="fas fa-chart-bar"></i> Resumen de Tests</h2>
            <div id="testSummary">
                <p>Ejecuta los tests anteriores para ver el resumen aquí.</p>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="js/calculator.js"></script>
    <script>
        let calculator = new MaterialCalculator(CONFIG);
        let testCount = 0;
        let passCount = 0;

        function setDevice(device) {
            const widths = {
                'mobile': 320,
                'tablet': 768,
                'desktop': 1200
            };

            const width = widths[device];
            document.documentElement.style.width = width + 'px';
            document.documentElement.style.margin = '0 auto';
            document.body.style.width = width + 'px';

            document.querySelectorAll('.device-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            document.getElementById('currentWidth').textContent = width;
        }

        function displayResults(elementId, title, results, passed = true) {
            testCount++;
            if (passed) passCount++;

            const html = `
                <div class="test-results">
                    <h4>${title}</h4>
                    ${results.map(r => `
                        <div class="result-item">
                            <span class="result-label">${r.label}:</span>
                            <span class="result-value">${r.value}</span>
                        </div>
                    `).join('')}
                    <div class="result-item" style="margin-top: 10px; padding-top: 10px; border-top: 2px solid var(--border);">
                        <span class="status-${passed ? 'pass' : 'fail'}">
                            ${passed ? '✓ Test Pasado' : '✗ Test Fallido'}
                        </span>
                    </div>
                </div>
            `;
            document.getElementById(elementId).innerHTML = html;
            updateSummary();
        }

        function displayError(elementId, message) {
            testCount++;
            document.getElementById(elementId).innerHTML = `
                <div class="error-message">
                    <strong>Error:</strong> ${message}
                </div>
            `;
            updateSummary();
        }

        function updateSummary() {
            const percentage = testCount > 0 ? Math.round((passCount / testCount) * 100) : 0;
            document.getElementById('testSummary').innerHTML = `
                <div class="result-item">
                    <span class="result-label">Tests ejecutados:</span>
                    <span class="result-value">${testCount}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Tests pasados:</span>
                    <span class="result-value status-pass">${passCount}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Porcentaje de éxito:</span>
                    <span class="result-value">${percentage}%</span>
                </div>
            `;
        }

        function testPerimeter() {
            try {
                const length = parseFloat(document.getElementById('length').value);
                const width = parseFloat(document.getElementById('width').value);

                if (!length || !width) {
                    displayError('perimeterResults', 'Ingresa valores válidos para largo y ancho');
                    return;
                }

                const perimeter = calculator.calculatePerimeter(length, width);
                displayResults('perimeterResults', 'Cálculo de Perímetro', [
                    { label: 'Largo', value: length + ' m' },
                    { label: 'Ancho', value: width + ' m' },
                    { label: 'Perímetro', value: perimeter.toFixed(2) + ' m' }
                ]);
            } catch (error) {
                displayError('perimeterResults', error.message);
            }
        }

        function testPosts() {
            try {
                const perimeter = parseFloat(document.getElementById('perimeterInput').value);
                const spacing = parseFloat(document.getElementById('spacing').value);

                if (!perimeter) {
                    displayError('postsResults', 'Ingresa un perímetro válido');
                    return;
                }

                const posts = calculator.calculatePosts(perimeter, spacing);
                displayResults('postsResults', 'Cálculo de Postes', [
                    { label: 'Perímetro', value: perimeter + ' m' },
                    { label: 'Espaciado', value: spacing + ' m' },
                    { label: 'Postes esquineros', value: posts.corner },
                    { label: 'Postes intermedios', value: posts.intermediate },
                    { label: 'Total de postes', value: posts.total }
                ]);
            } catch (error) {
                displayError('postsResults', error.message);
            }
        }

        function testWire() {
            try {
                const perimeter = parseFloat(document.getElementById('wirePerimeter').value);
                const strands = parseInt(document.getElementById('strands').value);

                if (!perimeter || !strands) {
                    displayError('wireResults', 'Ingresa valores válidos');
                    return;
                }

                const wire = calculator.calculateWire(perimeter, strands);
                displayResults('wireResults', 'Cálculo de Alambre', [
                    { label: 'Perímetro', value: perimeter + ' m' },
                    { label: 'Número de hilos', value: strands },
                    { label: 'Metros por hilo', value: wire.metersPerStrand + ' m' },
                    { label: 'Total de metros', value: wire.totalMeters + ' m' },
                    { label: 'Peso estimado', value: wire.estimatedKg + ' kg' }
                ]);
            } catch (error) {
                displayError('wireResults', error.message);
            }
        }

        function testMesh() {
            try {
                const perimeter = parseFloat(document.getElementById('meshPerimeter').value);
                const height = parseFloat(document.getElementById('meshHeight').value);

                if (!perimeter || !height) {
                    displayError('meshResults', 'Ingresa valores válidos');
                    return;
                }

                const mesh = calculator.calculateMesh(perimeter, height);
                displayResults('meshResults', 'Cálculo de Tejido Romboidal', [
                    { label: 'Perímetro', value: perimeter + ' m' },
                    { label: 'Altura', value: height + ' m' },
                    { label: 'Largo de rollo', value: mesh.rollLength + ' m' },
                    { label: 'Rollos necesarios', value: mesh.rollsNeeded },
                    { label: 'Cobertura total', value: mesh.coverage + ' m' }
                ]);
            } catch (error) {
                displayError('meshResults', error.message);
            }
        }

        function testOlimpo() {
            try {
                const perimeter = parseFloat(document.getElementById('olimpoPerimeter').value);

                if (!perimeter) {
                    displayError('olimpoResults', 'Ingresa un perímetro válido');
                    return;
                }

                const olimpo = calculator.calculateOlimpoSpecial(perimeter);
                displayResults('olimpoResults', 'Cálculo Postes Olimpo', [
                    { label: 'Perímetro', value: perimeter + ' m' },
                    { label: 'Tipo de alambre', value: olimpo.wireType },
                    { label: 'Número de hilos', value: olimpo.strands },
                    { label: 'Total de metros', value: olimpo.totalMeters + ' m' },
                    { label: 'Peso estimado', value: olimpo.estimatedKg + ' kg' }
                ]);
            } catch (error) {
                displayError('olimpoResults', error.message);
            }
        }

        function testValidation() {
            const value = document.getElementById('validationInput').value;
            const validation = calculator.validateInput(value);

            if (validation.valid) {
                displayResults('validationResults', 'Validación de Input', [
                    { label: 'Valor ingresado', value: value },
                    { label: 'Valor parseado', value: validation.value },
                    { label: 'Estado', value: 'Válido ✓' }
                ], true);
            } else {
                displayError('validationResults', validation.error);
            }
        }

        function testComplete() {
            try {
                const length = parseFloat(document.getElementById('compLength').value);
                const width = parseFloat(document.getElementById('compWidth').value);
                const postType = document.getElementById('compPostType').value;
                const materialType = document.getElementById('compMaterialType').value;

                if (!length || !width) {
                    displayError('completeResults', 'Ingresa dimensiones válidas');
                    return;
                }

                const result = calculator.calculateComplete({
                    length: length,
                    width: width,
                    postType: postType,
                    materialType: materialType,
                    wireStrands: 5,
                    meshHeight: 1.5
                });

                const results = [
                    { label: 'Perímetro', value: result.perimeter.toFixed(2) + ' m' },
                    { label: 'Tipo de poste', value: postType },
                    { label: 'Total de postes', value: result.posts.total },
                    { label: 'Material', value: materialType === 'wire' ? 'Alambre' : 'Tejido' }
                ];

                if (result.wire) {
                    results.push({ label: 'Metros de alambre', value: result.wire.totalMeters + ' m' });
                }
                if (result.mesh) {
                    results.push({ label: 'Rollos de tejido', value: result.mesh.rollsNeeded });
                }

                displayResults('completeResults', 'Cálculo Completo', results);
            } catch (error) {
                displayError('completeResults', error.message);
            }
        }

        // Inicializar con mobile por defecto
        window.addEventListener('load', () => {
            setDevice('mobile');
        });
    </script>
</body>
</html>
