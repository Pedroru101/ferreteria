<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Gestión de Productos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/admin.css">
    <script src="config.js"></script>
    <style>
        body {
            background: var(--bg-primary);
            padding: 20px;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
        }
        .test-section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid var(--border-color);
        }
        .test-section:last-child {
            border-bottom: none;
        }
        .test-section h2 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }
        .test-result {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .test-result.pass {
            background: rgba(76, 175, 80, 0.15);
            color: #4caf50;
            border-left: 4px solid #4caf50;
        }
        .test-result.fail {
            background: rgba(211, 47, 47, 0.15);
            color: #d32f2f;
            border-left: 4px solid #d32f2f;
        }
        .test-result.info {
            background: rgba(2, 136, 209, 0.15);
            color: #0288d1;
            border-left: 4px solid #0288d1;
        }
        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }
        .btn-test {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-test.primary {
            background: var(--gradient-primary);
            color: white;
        }
        .btn-test.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(45, 122, 62, 0.3);
        }
        .btn-test.secondary {
            background: var(--bg-secondary);
            color: var(--primary);
            border: 1px solid var(--border-color);
        }
        .btn-test.secondary:hover {
            background: var(--border-color);
        }
        .test-data {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 style="margin-bottom: 30px; color: var(--text-primary);">
            <i class="fas fa-vial"></i> Test - Gestión de Productos
        </h1>

        <div class="test-section">
            <h2>1. Crear Productos</h2>
            <div class="button-group">
                <button class="btn-test primary" onclick="testCreateProduct()">
                    <i class="fas fa-plus"></i> Crear Producto
                </button>
                <button class="btn-test secondary" onclick="testCreateMultipleProducts()">
                    <i class="fas fa-plus-circle"></i> Crear 5 Productos
                </button>
            </div>
            <div id="createProductResults"></div>
        </div>

        <div class="test-section">
            <h2>2. Leer Productos</h2>
            <div class="button-group">
                <button class="btn-test primary" onclick="testReadProducts()">
                    <i class="fas fa-list"></i> Listar Productos
                </button>
                <button class="btn-test secondary" onclick="testGetProductCount()">
                    <i class="fas fa-calculator"></i> Contar Productos
                </button>
            </div>
            <div id="readProductResults"></div>
        </div>

        <div class="test-section">
            <h2>3. Actualizar Productos</h2>
            <div class="button-group">
                <button class="btn-test primary" onclick="testUpdateProduct()">
                    <i class="fas fa-edit"></i> Actualizar Producto
                </button>
                <button class="btn-test secondary" onclick="testUpdateMultipleProducts()">
                    <i class="fas fa-edit"></i> Actualizar Precios (+10%)
                </button>
            </div>
            <div id="updateProductResults"></div>
        </div>

        <div class="test-section">
            <h2>4. Eliminar Productos</h2>
            <div class="button-group">
                <button class="btn-test primary" onclick="testDeleteProduct()">
                    <i class="fas fa-trash"></i> Eliminar Producto
                </button>
                <button class="btn-test secondary" onclick="testClearAllProducts()">
                    <i class="fas fa-broom"></i> Limpiar Todo
                </button>
            </div>
            <div id="deleteProductResults"></div>
        </div>

        <div class="test-section">
            <h2>5. Validación de Datos</h2>
            <div class="button-group">
                <button class="btn-test primary" onclick="testValidation()">
                    <i class="fas fa-check-circle"></i> Validar Datos
                </button>
                <button class="btn-test secondary" onclick="testCategories()">
                    <i class="fas fa-tags"></i> Obtener Categorías
                </button>
            </div>
            <div id="validationResults"></div>
        </div>

        <div class="test-section">
            <h2>6. Datos Actuales en localStorage</h2>
            <button class="btn-test secondary" onclick="showStorageData()">
                <i class="fas fa-database"></i> Ver Datos
            </button>
            <div id="storageData"></div>
        </div>
    </div>

    <script src="js/products-data.js"></script>
    <script src="js/admin.js"></script>
    <script>
        function addResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const result = document.createElement('div');
            result.className = `test-result ${type}`;
            result.innerHTML = `<i class="fas fa-${type === 'pass' ? 'check' : type === 'fail' ? 'times' : 'info-circle'}"></i> ${message}`;
            element.appendChild(result);
        }

        function clearResults(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }

        function testCreateProduct() {
            clearResults('createProductResults');
            try {
                const products = JSON.parse(localStorage.getItem('ferreteria_products') || '[]');
                const newProduct = {
                    id: 'prod_test_' + Date.now(),
                    name: 'Producto Test ' + new Date().toLocaleTimeString(),
                    category: 'Test',
                    description: 'Producto creado para prueba',
                    price: Math.floor(Math.random() * 5000) + 1000,
                    stock: Math.floor(Math.random() * 100),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                products.push(newProduct);
                localStorage.setItem('ferreteria_products', JSON.stringify(products));
                addResult('createProductResults', `Producto creado: ${newProduct.name} (ID: ${newProduct.id})`, 'pass');
            } catch (error) {
                addResult('createProductResults', `Error: ${error.message}`, 'fail');
            }
        }

        function testCreateMultipleProducts() {
            clearResults('createProductResults');
            try {
                const products = JSON.parse(localStorage.getItem('ferreteria_products') || '[]');
                const categories = ['Postes', 'Alambres', 'Tejidos', 'Accesorios'];
                let created = 0;

                for (let i = 0; i < 5; i++) {
                    const newProduct = {
                        id: 'prod_test_' + Date.now() + '_' + i,
                        name: `Producto Test ${i + 1}`,
                        category: categories[i % categories.length],
                        description: `Descripción del producto test ${i + 1}`,
                        price: (i + 1) * 1000,
                        stock: (i + 1) * 10,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    products.push(newProduct);
                    created++;
                }

                localStorage.setItem('ferreteria_products', JSON.stringify(products));
                addResult('createProductResults', `${created} productos creados exitosamente`, 'pass');
            } catch (error) {
                addResult('createProductResults', `Error: ${error.message}`, 'fail');
            }
        }

        function testReadProducts() {
            clearResults('readProductResults');
            try {
                const products = JSON.parse(localStorage.getItem('ferreteria_products') || '[]');
                addResult('readProductResults', `Total de productos: ${products.length}`, 'info');
                
                if (products.length > 0) {
                    const html = '<div class="test-data">' + 
                        products.slice(0, 3).map(p => 
                            `<div><strong>${p.name}</strong> - ${p.category} - $${p.price}</div>`
                        ).join('') +
                        (products.length > 3 ? `<div>... y ${products.length - 3} más</div>` : '') +
                        '</div>';
                    document.getElementById('readProductResults').innerHTML += html;
                    addResult('readProductResults', 'Lectura exitosa', 'pass');
                } else {
                    addResult('readProductResults', 'No hay productos en localStorage', 'info');
                }
            } catch (error) {
                addResult('readProductResults', `Error: ${error.message}`, 'fail');
            }
        }

        function testGetProductCount() {
            clearResults('readProductResults');
            try {
                const products = JSON.parse(localStorage.getItem('ferreteria_products') || '[]');
                const categories = {};
                products.forEach(p => {
                    categories[p.category] = (categories[p.category] || 0) + 1;
                });

                addResult('readProductResults', `Total: ${products.length} productos`, 'info');
                Object.entries(categories).forEach(([cat, count]) => {
                    addResult('readProductResults', `${cat}: ${count} productos`, 'info');
                });
            } catch (error) {
                addResult('readProductResults', `Error: ${error.message}`, 'fail');
            }
        }

        function testUpdateProduct() {
            clearResults('updateProductResults');
            try {
                const products = JSON.parse(localStorage.getItem('ferreteria_products') || '[]');
                if (products.length === 0) {
                    addResult('updateProductResults', 'No hay productos para actualizar', 'info');
                    return;
                }

                const product = products[0];
                product.price = product.price * 1.1;
                product.stock = Math.max(0, product.stock - 1);
                product.updatedAt = new Date().toISOString();

                localStorage.setItem('ferreteria_products', JSON.stringify(products));
                addResult('updateProductResults', `Producto actualizado: ${product.name}`, 'pass');
                addResult('updateProductResults', `Nuevo precio: $${product.price.toFixed(2)}`, 'info');
            } catch (error) {
                addResult('updateProductResults', `Error: ${error.message}`, 'fail');
            }
        }

        function testUpdateMultipleProducts() {
            clearResults('updateProductResults');
            try {
                const products = JSON.parse(localStorage.getItem('ferreteria_products') || '[]');
                let updated = 0;

                products.forEach(p => {
                    p.price = p.price * 1.1;
                    p.updatedAt = new Date().toISOString();
                    updated++;
                });

                localStorage.setItem('ferreteria_products', JSON.stringify(products));
                addResult('updateProductResults', `${updated} productos actualizados (+10% en precio)`, 'pass');
            } catch (error) {
                addResult('updateProductResults', `Error: ${error.message}`, 'fail');
            }
        }

        function testDeleteProduct() {
            clearResults('deleteProductResults');
            try {
                const products = JSON.parse(localStorage.getItem('ferreteria_products') || '[]');
                if (products.length === 0) {
                    addResult('deleteProductResults', 'No hay productos para eliminar', 'info');
                    return;
                }

                const deleted = products.pop();
                localStorage.setItem('ferreteria_products', JSON.stringify(products));
                addResult('deleteProductResults', `Producto eliminado: ${deleted.name}`, 'pass');
                addResult('deleteProductResults', `Productos restantes: ${products.length}`, 'info');
            } catch (error) {
                addResult('deleteProductResults', `Error: ${error.message}`, 'fail');
            }
        }

        function testClearAllProducts() {
            clearResults('deleteProductResults');
            if (!confirm('¿Estás seguro de que deseas eliminar todos los productos?')) {
                return;
            }
            try {
                localStorage.removeItem('ferreteria_products');
                addResult('deleteProductResults', 'Todos los productos han sido eliminados', 'pass');
            } catch (error) {
                addResult('deleteProductResults', `Error: ${error.message}`, 'fail');
            }
        }

        function testValidation() {
            clearResults('validationResults');
            try {
                const products = JSON.parse(localStorage.getItem('ferreteria_products') || '[]');
                let valid = 0;
                let invalid = 0;

                products.forEach(p => {
                    const hasRequiredFields = p.id && p.name && p.category && typeof p.price === 'number';
                    if (hasRequiredFields) {
                        valid++;
                    } else {
                        invalid++;
                    }
                });

                addResult('validationResults', `Productos válidos: ${valid}`, 'pass');
                if (invalid > 0) {
                    addResult('validationResults', `Productos inválidos: ${invalid}`, 'fail');
                }
            } catch (error) {
                addResult('validationResults', `Error: ${error.message}`, 'fail');
            }
        }

        function testCategories() {
            clearResults('validationResults');
            try {
                const products = JSON.parse(localStorage.getItem('ferreteria_products') || '[]');
                const categories = new Set();
                products.forEach(p => {
                    if (p.category) categories.add(p.category);
                });

                addResult('validationResults', `Total de categorías: ${categories.size}`, 'info');
                Array.from(categories).forEach(cat => {
                    addResult('validationResults', `- ${cat}`, 'info');
                });
            } catch (error) {
                addResult('validationResults', `Error: ${error.message}`, 'fail');
            }
        }

        function showStorageData() {
            clearResults('storageData');
            try {
                const products = JSON.parse(localStorage.getItem('ferreteria_products') || '[]');
                const html = '<div class="test-data">' + 
                    JSON.stringify(products, null, 2) +
                    '</div>';
                document.getElementById('storageData').innerHTML = html;
            } catch (error) {
                addResult('storageData', `Error: ${error.message}`, 'fail');
            }
        }

        // Cargar datos iniciales
        window.addEventListener('load', () => {
            addResult('readProductResults', 'Test de gestión de productos cargado', 'info');
        });
    </script>
</body>
</html>
