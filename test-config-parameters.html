<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Configuración de Parámetros</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/admin.css">
    <script src="config.js"></script>
</head>
<body>
    <div style="padding: 20px; max-width: 800px; margin: 0 auto;">
        <h1>Test - Configuración de Parámetros</h1>
        
        <div id="testResults" style="margin-top: 20px;">
            <h2>Resultados de Pruebas</h2>
            <div id="results"></div>
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #f5f5f5; border-radius: 8px;">
            <h2>Pruebas Manuales</h2>
            <p>1. Abre el panel de administración en <a href="admin.html" target="_blank">admin.html</a></p>
            <p>2. Inicia sesión con la contraseña por defecto: <code>admin123</code></p>
            <p>3. Ve a la pestaña "Configuración"</p>
            <p>4. Modifica los valores:</p>
            <ul>
                <li>Separación entre postes: 3.0</li>
                <li>Postes esquineros: 5</li>
                <li>Costo de instalación: 600</li>
                <li>Margen de ganancia: 25</li>
                <li>Validez de cotizaciones: 45</li>
            </ul>
            <p>5. Haz clic en "Guardar Configuración"</p>
            <p>6. Verifica que la página se recargue y los valores se mantengan</p>
            <p>7. Abre la consola del navegador (F12) y ejecuta:</p>
            <code style="display: block; padding: 10px; background: #000; color: #0f0; margin: 10px 0; border-radius: 4px;">
                JSON.parse(localStorage.getItem('ferreteria_config'))
            </code>
            <p>8. Verifica que los valores guardados coincidan con los ingresados</p>
        </div>
    </div>

    <script>
        function runTests() {
            const results = [];

            // Test 1: Verificar que CONFIG existe
            results.push({
                name: 'CONFIG global existe',
                passed: typeof CONFIG !== 'undefined',
                details: CONFIG ? 'CONFIG está disponible' : 'CONFIG no está definido'
            });

            // Test 2: Verificar estructura de CONFIG
            results.push({
                name: 'CONFIG tiene estructura correcta',
                passed: CONFIG.calculator && CONFIG.pricing && CONFIG.quotation,
                details: 'Todas las secciones están presentes'
            });

            // Test 3: Verificar valores por defecto
            results.push({
                name: 'Valores por defecto de calculadora',
                passed: CONFIG.calculator.defaultPostSpacing === 2.5 && CONFIG.calculator.cornerPosts === 4,
                details: `Separación: ${CONFIG.calculator.defaultPostSpacing}m, Postes: ${CONFIG.calculator.cornerPosts}`
            });

            // Test 4: Verificar valores por defecto de precios
            results.push({
                name: 'Valores por defecto de precios',
                passed: CONFIG.pricing.installationPricePerMeter === 500 && CONFIG.pricing.marginPercentage === 20,
                details: `Instalación: $${CONFIG.pricing.installationPricePerMeter}/m, Margen: ${CONFIG.pricing.marginPercentage}%`
            });

            // Test 5: Verificar valores por defecto de cotizaciones
            results.push({
                name: 'Valores por defecto de cotizaciones',
                passed: CONFIG.quotation.validityDays === 30,
                details: `Validez: ${CONFIG.quotation.validityDays} días`
            });

            // Test 6: Verificar localStorage
            const savedConfig = localStorage.getItem('ferreteria_config');
            results.push({
                name: 'localStorage puede guardar configuración',
                passed: true,
                details: savedConfig ? 'Configuración guardada previamente' : 'Sin configuración guardada (primera vez)'
            });

            // Test 7: Verificar que se puede parsear la configuración guardada
            if (savedConfig) {
                try {
                    const parsed = JSON.parse(savedConfig);
                    results.push({
                        name: 'Configuración guardada es válida',
                        passed: true,
                        details: JSON.stringify(parsed, null, 2)
                    });
                } catch (e) {
                    results.push({
                        name: 'Configuración guardada es válida',
                        passed: false,
                        details: 'Error al parsear: ' + e.message
                    });
                }
            }

            // Mostrar resultados
            const resultsDiv = document.getElementById('results');
            let html = '<table style="width: 100%; border-collapse: collapse;">';
            html += '<tr style="background: #e0e0e0;"><th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Prueba</th><th style="padding: 10px; text-align: center; border: 1px solid #ccc;">Estado</th><th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Detalles</th></tr>';

            results.forEach(result => {
                const statusColor = result.passed ? '#4caf50' : '#d32f2f';
                const statusText = result.passed ? 'PASÓ' : 'FALLÓ';
                html += `<tr style="background: ${result.passed ? '#f1f8f6' : '#fef1f1'};">`;
                html += `<td style="padding: 10px; border: 1px solid #ccc;">${result.name}</td>`;
                html += `<td style="padding: 10px; text-align: center; border: 1px solid #ccc; color: ${statusColor}; font-weight: bold;">${statusText}</td>`;
                html += `<td style="padding: 10px; border: 1px solid #ccc; font-size: 12px; font-family: monospace; white-space: pre-wrap; word-break: break-all;">${result.details}</td>`;
                html += '</tr>';
            });

            html += '</table>';
            resultsDiv.innerHTML = html;

            const passedCount = results.filter(r => r.passed).length;
            const totalCount = results.length;
            console.log(`Pruebas completadas: ${passedCount}/${totalCount} pasaron`);
        }

        // Ejecutar pruebas al cargar
        window.addEventListener('load', runTests);
    </script>
</body>
</html>
